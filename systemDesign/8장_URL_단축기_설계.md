# 8장 URL 단축기 설계



### 1단계. 문제 이해 및 설계 범위 확정

시스템 설계 문제를 풀기 위해서는 적절한 질문이 필요하다.

이번 문제에 대해서 요구사항은 다음과 같다.

- https://{scheme}/{path}?{query}#{fragment} 입력이 주어졌을 때 https://tiny.url/y7ke-oc와 같은 단축 URL을 결과로 제공해야 한다,
- 매일 1억개의 단축 URL을 만들어야 한다.
- 길이는 정해지지 않았지만, 짧을수록 좋다.
- 단축 URL에는 숫자(0~9), 영문자(a~z, A~Z) 만 사용 가능하다.
- 단축 URL의 삭제나 갱신은 불가능하다.

이 시스템의 기능은 다음과 같다.

1. URL 단축 : 주어진 긴 URL을 짧게 줄인다.

2. URL 리디렉션 : 축약된 URL로 HTTP 요청이 오면 원래 URL로 안내

3. 높은 가용성과 규모 확장성, 장애 감내가 요구됨.

   

##### 개략적 추정

- 초당 쓰기 연산 : 1억 / 24 / 3600 = 1160
- 읽기 연산과 쓰기 연산의 비율이 10:1이라고 할 때, 읽기 연산은 초당 11,600회 발생한다.
- URL 단축 서비스를 10년간 운영한다고 가정하면 1억 * 365 * 10 = 3650억개의 레코드를 보관해야 한다.
- 10년 동안 필요한 저장 용량은 3650억 * 100바이트 = 36.5TB 이다.



### 2단계. 개략적 설계안 제시 및 동의 구하기

API 엔드포인트, URL 리디렉션, URL 단축 플로우는 다음과 같다. 

##### API 엔드포인트

클라이언트는 서버가 제공하는 API 엔드포인트를 통해 서버와 통신한다. URL 단축키는 기본적으로 두 개의 엔드포인트를 필요로 한다.

###### 1. URL 단축용 엔드포인트 

- 단축 URL을 생성하고자 하는 클라이언트는 엔드포인트에 단축할 URL을 Parameter로 실어서 POST 요청을 보내야 한다. 이 엔드 포인트는 다음과 같은 형태를 띈다.

  POST /api/v1/data/shorten

  - Request Parameter: {longUrl: URLString}
  - Response : 단축 URL

###### 2. URL 디리렉션용 엔드포인트 

- 단축 URL에 대해서 HTTP 요청이 오면 원래 URL로 보내주기 위한 용도의 엔드포인트

  GET /api/v1/shortUrl

  - Response: HTTP 리디렉션 목적지가 될 원래 URL

    

##### URL 리디렉션

브라우저에 단축 URL을 입력하면 단축 URL을 받은 서버는 그 URL을 원래 URL로 바꾸어서 301 응답의 Location 헤더에 넣어 반환한다.

클라이언트와 서버 사이 통신 절차는 다음과 같다.





##### URL 단축 플로우



### 3단계. 상세 설계



### 4단계. 마무리

